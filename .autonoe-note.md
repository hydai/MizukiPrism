# Session Handoff Notes - 2026-02-18 (Planning Session)

## Gap Analysis

The previous session (22 tasks) marked all SPEC requirements as implemented. However, SPEC.md was subsequently updated with 3 doc-only commits (`8f32f2c`, `e0405ee`, `4ed16d3`) that added new requirements and clarifications:

1. **§3.4.9 Mobile Layout** (added in `8f32f2c`): Complete mobile layout specification with TopBar, BottomNav, MobileHero, MobileActionBar, MobileTagScroll, MobileSongList, and MiniPlayer mobile redesign. Current implementation uses a hamburger menu + slide-over sidebar which does NOT match the spec.

2. **§3.1.5 Deleted version auto-skip** (added in `e0405ee`): "播放清單連續播放中遇到已刪除版本 | 自動跳至下一首" — not implemented. PlaylistPanel marks deleted versions visually but player doesn't auto-skip during continuous playback.

3. **§3.1.6 + §3.2 Duplicate song validation on edit** (added in `4ed16d3`): "策展人已驗證 | 編輯歌曲後設資料導致 name + artist 與既有歌曲重複 | 表單驗證阻止儲存" — PUT endpoint in `app/api/songs/[id]/route.ts` has no duplicate check.

4. **§3.4.2 Brand name** (clarified in `4ed16d3`): "MizukiPlay" is the user-facing brand name; "MizukiPrism" is the project codename. UI currently shows "MizukiPrism" in the sidebar.

## Task Plan (6 tasks)

### Independent fixes (can run in parallel)
- **FIX-005**: Brand name "MizukiPrism" → "MizukiPlay" (cosmetic, `app/page.tsx`)
- **FIX-006**: Duplicate song name+artist validation on edit (`app/api/songs/[id]/route.ts`)
- **FIX-007**: Auto-skip deleted versions during playback (`app/contexts/PlayerContext.tsx`)

### Mobile layout chain (sequential, all modify `app/page.tsx`)
- **MOBILE-001**: TopBar + BottomNav (replaces hamburger sidebar) — blocked by FIX-005
- **MOBILE-002**: MobileHero + MobileActionBar + MobileTagScroll — blocked by MOBILE-001
- **MOBILE-003**: MobileSongList + MiniPlayer mobile — blocked by MOBILE-002

### Dependency Graph
```
FIX-005 ─→ MOBILE-001 ─→ MOBILE-002 ─→ MOBILE-003
FIX-006 (independent)
FIX-007 (independent)
```

### Execution Strategy
No worktree guidance in project. Execute sequentially:
1. FIX-005 (brand name) — quick
2. FIX-006 (duplicate validation) — parallel-safe but sequential for safety
3. FIX-007 (auto-skip) — parallel-safe but sequential for safety
4. MOBILE-001 (navigation restructure) — major change
5. MOBILE-002 (hero/action/tags) — depends on MOBILE-001
6. MOBILE-003 (song list/miniplayer) — depends on MOBILE-002

## Test Status (pre-planning)
- All 105 E2E tests pass
- `npm run build` compiles without errors
