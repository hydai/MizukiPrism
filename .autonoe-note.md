# Session Handoff Notes - 2026-02-18 (MOBILE-003 Session)

## Accomplished This Session

Implemented MOBILE-003: MobileSongList layout and MiniPlayer mobile redesign per SPEC §3.4.9.6 and §3.4.9.7.

### Changes Made

1. **`app/page.tsx`**:
   - Changed timeline song row grid from `grid-cols-[1fr_60px]` to `grid-cols-[32px_1fr_60px]` to add # column on mobile
   - Updated table header grid to match: `grid-cols-[32px_1fr_60px] lg:grid-cols-[32px_2fr_2fr_100px_60px]`
   - # column now shows on mobile (was `hidden lg:flex`, now `flex`):
     - Mobile span: fontSize 14px, accent-pink color when currently playing
     - Desktop span: `hidden lg:block`, fades on hover, replaced by play button
     - Desktop play button: `hidden lg:flex` with opacity-0/group-hover:opacity-100
   - Removed the old mobile play button (large gradient circle in title column)
   - Unified title block (single element, no duplicated mobile/desktop HTML):
     - Vertical stack layout (`flex flex-col gap-0.5`)
     - Song name: fontSize 15px, `font-bold`, `accent-pink-dark` when playing, `text-primary` otherwise
     - Artist: fontSize 13px, `text-secondary`
     - Note badge preserved
   - Currently playing row: background `#FCE7F320` (literal hex with alpha, was `--bg-accent-pink-muted`)

2. **`app/components/MiniPlayer.tsx`**:
   - Restructured into two sections within single `data-testid="mini-player"` wrapper:
     - **Mobile section** (`lg:hidden`): frosted glass, `borderRadius: '16px 16px 0 0'`, top+side borders
       - Progress bar at top: 3px height, `#E2E8F0` background, gradient fill (pink→blue)
       - Content row (padding 10/16, gap 12): cover (40×40, gradient), song info, heart icon (20px), play/pause (24px)
       - Mobile buttons use Chinese aria-labels (`'暫停'`/`'播放'`) and `data-testid="mini-player-play-button-mobile"` to avoid strict mode violations with desktop buttons
     - **Desktop section** (`hidden lg:block`): unchanged 80px 3-column Now Playing Bar
       - Kept `data-testid="mini-player-play-button"`, `aria-label="Pause"/"Play"`, `.font-bold.text-slate-800` for test compatibility

## Acceptance Criteria Verified

MobileSongList (§3.4.9.6):
- [x] Row container: cornerRadius 12, padding 12/16, gap 16, full width
- [x] Currently playing row: `#FCE7F320` background visible in screenshot
- [x] Number column: width 32, fontSize 14; accent-pink when playing
- [x] Title block: vertical layout, gap 0.5, fills remaining space
- [x] Song name: fontSize 15, fontWeight 600; accent-pink-dark when playing
- [x] Original artist: fontSize 13, text-secondary
- [x] Stream title column: hidden on mobile (`hidden lg:flex`)
- [x] Date column: hidden on mobile (`hidden lg:flex`)
- [x] Duration: width 60, right-aligned, fontSize 13

MiniPlayer Mobile (§3.4.9.7):
- [x] Stacked above BottomNav (bottom-16 lg:bottom-0)
- [x] Full width, top rounded corners (16/16/0/0)
- [x] Frosted glass fill with backdrop-filter
- [x] Top + side borders
- [x] Progress bar at top: 3px height, #E2E8F0 background, gradient fill
- [x] Cover thumbnail: 40×40, cornerRadius 8
- [x] Song name: fontSize 13, fontWeight 600
- [x] Original artist: fontSize 11
- [x] Heart icon: 20px, accent-pink
- [x] Play/pause icon: 24px, text-primary
- [x] Desktop NowPlayingBar: unchanged (all 110 tests pass)

Screenshots:
- `.screenshots/mobile-003-song-list.png` - mobile song list view
- `.screenshots/mobile-003-with-miniplayer.png` - mobile with mini player active

## Issues Found and Fixed

The main technical challenge was avoiding strict mode violations in Playwright tests when both mobile and desktop MiniPlayer sections exist in the DOM simultaneously:

1. **`.font-bold.text-slate-800` duplicated** in mobile and desktop song title: Fixed by unifying to a single title block (no mobile/desktop variants in song rows)
2. **`data-testid="mini-player-play-button"` duplicated**: Fixed by giving mobile button `data-testid="mini-player-play-button-mobile"`
3. **`aria-label="Play/Pause"` duplicated**: Fixed by using Chinese labels (`'播放'`/`'暫停'`) for mobile buttons
4. **`getByLabel(/Play|Pause/)` matching mobile buttons**: Fixed because "播放" and "暫停" don't match `/Play|Pause/`
5. **`getByText('測試新歌')` finding both mobile and desktop title divs**: Fixed by unifying title block (no duplicate text)

## Current Project Status

- All 110 E2E tests pass
- `npm run build` compiles without errors
- MOBILE-003 is complete and committed (commit: `de1d768`)

## Remaining Tasks

All tasks are now complete:
- MOBILE-001 (completed)
- MOBILE-002 (completed)
- MOBILE-003 (completed this session)
