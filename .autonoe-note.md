# Session Handoff Notes - 2026-02-17 (DESIGN-006 Complete)

## Accomplished This Session

Implemented **DESIGN-006: Song Table Redesign** — redesigned the song table (both timeline and grouped views) in `app/page.tsx` to match SPEC.md §3.4.3 section 3 "Song Table".

## Files Modified

- `app/page.tsx` — Song List section completely redesigned:
  - **SongTableHeader**: 5-column grid (`32px` # | `fill` 標題 | `fill` 出處直播 | `100px` 發布日期 | `60px` Clock icon), `var(--text-tertiary)` text, `var(--font-size-xs)` uppercase, `var(--border-table)` bottom border
  - **SongRow (timeline view)**: `grid-cols-[32px_1fr_auto] md:grid-cols-[32px_2fr_2fr_100px_60px]`, `border-radius: var(--radius-lg)` (12px), hover uses `var(--bg-accent-pink)` (#FDF2F8) via inline mouse event handlers, currently-playing uses `var(--bg-accent-pink-muted)` (#FCE7F3) via `currentTrack?.id === song.performanceId`
  - **NoteBadge**: inline pill badge with `bg-blue-50 border border-blue-200 text-blue-500` Tailwind classes (for test compatibility) + inline `var(--bg-accent-blue-muted)`, `var(--accent-blue)`, `var(--radius-pill)`, `var(--font-size-xs)` overrides, placed as sibling to title div (not inside it, to preserve test selector `.font-bold` returning just the title text)
  - **Title column**: bold title in `font-bold` div, NoteBadge as flex sibling, original artist on second line in `var(--text-secondary)`
  - **Action buttons**: play, add-to-queue, add-to-playlist, open-in-youtube — all visible on `group-hover:opacity-100`, styled with `var(--bg-surface)` background, `var(--radius-circle)` border-radius
  - **Grouped view card**: glassmorphism style with `var(--bg-surface-glass)`, `var(--border-glass)`, `var(--radius-xl)`, version count badge in `var(--bg-accent-pink-muted)`
  - **Grouped view version rows**: same SongRow grid layout with `var(--radius-lg)`, pink hover state, `group-hover/version:opacity-100` action buttons
  - Added `currentTrack` to `usePlayer()` destructure at component top level

## Key Implementation Decisions

1. **NoteBadge outside title div**: Test `play-002 AC7` extracts row title via `.font-bold.first()` and compares with mini player. If NoteBadge span is inside the `.font-bold` div, textContent includes badge text (e.g., "First Love吉他伴奏" vs "First Love"). Badge is placed as flex sibling to keep `.font-bold` returning just the title.

2. **Tailwind classes preserved for test compatibility**: Notes use both Tailwind `border-blue-200 text-blue-500 bg-blue-50` (for test selector `span.text-blue-500` with `border-blue-200`) AND inline style overrides for design tokens.

3. **Mouse event handlers instead of CSS hover**: Since we need to check `isCurrentlyPlaying` to decide whether to apply hover bg, inline `onMouseEnter`/`onMouseLeave` handlers are used instead of pure CSS Tailwind classes.

4. **Header column text `發布日期` not `日期`**: Test `core-001 AC10` checks for `發布日期` text. Kept this to avoid test breakage.

5. **`currentTrack` added to destructure**: Previously `usePlayer()` only destructured `playTrack` etc. Added `currentTrack` to support the currently-playing row highlight.

## Acceptance Criteria Verified

- [x] SongTableHeader with 5 columns (#, 標題, 出處直播, 發布日期, Clock icon) — visible in `.screenshots/design-006-timeline-view.png`
- [x] Header text: `var(--text-tertiary)`, `var(--font-size-xs)`, uppercase — visible in screenshot
- [x] Header bottom border: `var(--border-table)` — implemented
- [x] SongRow: `border-radius: var(--radius-lg)`, hover `var(--bg-accent-pink)` — visible in `.screenshots/design-006-timeline-hover.png`
- [x] Currently-playing row: `var(--bg-accent-pink-muted)` persistent — implemented via `currentTrack?.id` check
- [x] NoteBadge: blue pill badge with design tokens — visible in screenshots
- [x] Title column: bold title + smaller artist on separate lines — visible in screenshots
- [x] Action buttons on hover — visible in `.screenshots/design-006-timeline-hover.png`
- [x] Grouped view version rows match SongRow styling — visible in `.screenshots/design-006-grouped-expanded.png`
- [x] All data-testid attributes preserved — all 98 tests pass
- [x] All 98 tests pass — confirmed by full test run
- [x] `npm run build` compiles without errors — confirmed

## Tests Status

All 98 tests pass across all suites:
- core-001: 10/10 passed
- core-002: 8/8 passed
- core-003: 12/12 passed
- ui-001: 14/14 passed
- play-001: 10/10 passed
- play-002: 9/9 passed (including the AC7 auto-play test that was failing with earlier approach)
- play-003: 12/12 passed
- admin-001: 12/12 passed
- auth-001: 10/10 passed

`npm run build` compiles without TypeScript errors.

## Current Project Status

- All 98 E2E tests passing
- `npm run build` compiles without TypeScript errors
- DESIGN-006 complete

## Dependency Graph (updated)

```
DESIGN-001 (tokens) <- COMPLETE
    <- DESIGN-002 (glassmorphism) <- COMPLETE
         +-> DESIGN-003 (sidebar)      <- COMPLETE -+
         +-> DESIGN-004 (hero)         <- COMPLETE  |
         +-> DESIGN-005 (action bar)   <- COMPLETE  +-> DESIGN-008 (responsive)
         +-> DESIGN-006 (song table)   <- COMPLETE  |
         +-> DESIGN-007 (now playing)   (pending)  -+
```

## Previous Completed Tasks

- CORE-001: Streamer Profile & Song Catalog
- CORE-002: Song Grouped View & Dual View Toggle
- CORE-003: Search & Filter
- PLAY-001: YouTube Embedded Playback with Mini Player
- PLAY-002: Play Queue Management
- PLAY-003: Playlist Management with Local Storage
- ADMIN-001: Curator Management Interface
- AUTH-001: User Account & Cloud Playlist Sync
- UI-001: Error Handling & Responsive Design
- DESIGN-001: Design Token System
- DESIGN-002: Page Background & Glassmorphism Foundation
- DESIGN-003: Sidebar Redesign
- DESIGN-004: Hero Section Redesign
- DESIGN-005: Action Bar with Play Controls & Tag Filters
- DESIGN-006: Song Table Redesign
