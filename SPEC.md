# MizukiPrism 規格書

## 1. Intent

### 1.1 Purpose

MizukiPrism 讓 Mizuki 的粉絲能快速瀏覽、搜尋並播放她在歌回直播中演唱過的所有歌曲，透過嵌入 YouTube VOD 的方式提供類似 Spotify 的音樂探索體驗。

### 1.2 Users

| 角色 | 描述 | 核心任務 |
|------|------|----------|
| 粉絲（Fan） | Mizuki 的觀眾，想回味或發現她唱過的歌 | 瀏覽歌曲目錄、搜尋特定歌曲、播放特定版本、建立與管理播放清單 |
| 策展人（Curator） | 負責維護歌曲資料的小型管理團隊 | 新增歌曲與版本資料、編輯後設資料、管理 YouTube 連結與時間戳 |

### 1.3 Impacts

| 影響指標 | 目標 |
|----------|------|
| 歌曲發現速度 | 粉絲能在 30 秒內找到 Mizuki 唱過的任何一首歌 |
| 版本瀏覽 | 粉絲能看到同一首歌的所有演唱版本並選擇偏好版本 |
| 播放體驗 | 粉絲能連續播放多首歌曲，無需手動切換 YouTube 影片 |
| 個人化 | 粉絲能建立自己的播放清單並跨裝置同步 |
| 資料維護效率 | 策展人能在 2 分鐘內完成一首歌曲版本的資料登錄 |

### 1.4 Success Criteria

- [ ] 歌曲目錄可瀏覽且可搜尋，支援歌名、原唱者、直播日期篩選
- [ ] 每首歌曲顯示所有演唱版本，每個版本可獨立播放
- [ ] YouTube 嵌入播放器能從正確時間戳開始播放
- [ ] 粉絲可建立播放清單，播放清單支援連續播放
- [ ] 未登入狀態下播放清單存於 localStorage；登入後可跨裝置同步
- [ ] 策展人可透過管理介面新增、編輯、刪除歌曲與版本資料
- [ ] UI 語言為繁體中文

### 1.5 Non-goals

- **非通用 VTuber 平台**：僅服務 Mizuki 的歌回內容，不支援其他 VTuber
- **非直播平台**：不提供即時串流功能，僅播放既有 VOD
- **非自動化抓取**：歌曲資料由策展人手動維護，不自動從 YouTube 擷取
- **非音樂下載器**：不提供任何下載功能，所有播放透過 YouTube 嵌入
- **非社群互動平台**：不提供留言、評分或社群功能

## 2. Scope

### 2.1 Feature List

| 功能 | 描述 | 使用者 |
|------|------|--------|
| 歌曲目錄（Song Catalog） | 列出所有 Mizuki 演唱過的歌曲，含歌名、原唱者、分類標籤 | 粉絲 |
| 版本追蹤（Version Tracking） | 每首歌記錄所有演唱版本，含直播日期、YouTube 連結、時間戳 | 粉絲 |
| 嵌入播放（YouTube Playback） | 透過 YouTube IFrame API 嵌入播放，自動跳轉至正確時間戳 | 粉絲 |
| 搜尋與篩選（Search & Filter） | 依歌名、原唱者、直播日期、標籤搜尋或篩選歌曲 | 粉絲 |
| 播放清單（Playlist） | 建立、編輯、刪除個人播放清單；支援連續播放與順序調整 | 粉絲 |
| 使用者帳號（User Account） | 選擇性登入；未登入用 localStorage，登入後跨裝置同步 | 粉絲 |
| 策展管理（Curator Management） | 新增／編輯／刪除歌曲、版本、直播資料的管理介面 | 策展人 |

### 2.2 User Journeys

#### Journey 1：粉絲探索歌曲

| 階段 | 內容 |
|------|------|
| 情境（Context） | 粉絲想知道 Mizuki 有沒有唱過某首歌 |
| 行動（Action） | 在搜尋欄輸入歌名或原唱者名稱 |
| 結果（Outcome） | 系統顯示匹配的歌曲列表；點擊歌曲後展開所有演唱版本，每個版本顯示直播日期與連結 |

#### Journey 2：粉絲播放與連續聆聽

| 階段 | 內容 |
|------|------|
| 情境（Context） | 粉絲找到想聽的歌曲版本，並想連續播放多首 |
| 行動（Action） | 點擊版本的播放按鈕；在播放過程中可將其他版本加入播放佇列 |
| 結果（Outcome） | YouTube 嵌入播放器從正確時間戳開始播放；播放結束後自動播放佇列中的下一首 |

#### Journey 3：粉絲建立播放清單

| 階段 | 內容 |
|------|------|
| 情境（Context） | 粉絲想把喜歡的版本整理成一個播放清單，方便日後重複聆聽 |
| 行動（Action） | 建立新播放清單、命名、從歌曲目錄中將版本加入播放清單 |
| 結果（Outcome） | 播放清單儲存完成，可一鍵啟動連續播放；未登入存在 localStorage，登入後同步至帳號 |

#### Journey 4：粉絲跨裝置同步

| 階段 | 內容 |
|------|------|
| 情境（Context） | 粉絲在手機上建立了播放清單，想在電腦上繼續使用 |
| 行動（Action） | 註冊或登入帳號，系統提示合併本機播放清單 |
| 結果（Outcome） | 本機與雲端的播放清單合併完成，兩端資料同步 |

#### Journey 5：策展人登錄新歌曲

| 階段 | 內容 |
|------|------|
| 情境（Context） | Mizuki 完成了一場歌回直播，策展人需要將新演唱的歌曲資料加入系統 |
| 行動（Action） | 登入管理介面 → 新增直播場次（YouTube 連結、日期）→ 逐首新增歌曲版本（歌名、原唱者、時間戳）；若歌曲已存在則直接新增版本 |
| 結果（Outcome） | 新版本即時出現在粉絲端的歌曲目錄中 |

## 3. Behavior

### 3.1 Feature Behaviors

#### 3.1.1 歌曲目錄（Song Catalog）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 目錄有歌曲 | 開啟首頁 | 顯示所有歌曲列表，按歌名筆畫排序，每首顯示歌名、原唱者、版本數量 |
| 目錄為空 | 開啟首頁 | 顯示空狀態提示：「目前尚無歌曲資料」 |
| 歌曲有多個版本 | 點擊歌曲卡片 | 展開版本列表，每個版本顯示直播日期、直播標題；按日期降冪排列（最新在前） |
| 歌曲只有一個版本 | 點擊歌曲卡片 | 展開版本列表，顯示唯一版本 |

#### 3.1.2 搜尋與篩選（Search & Filter）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 任意 | 輸入搜尋關鍵字 | 即時篩選歌曲列表，匹配歌名或原唱者（模糊搜尋，不區分大小寫）；最少輸入 1 字元即觸發 |
| 任意 | 選擇篩選條件（原唱者、日期範圍、標籤） | 歌曲列表僅顯示符合所有篩選條件的結果（AND 邏輯） |
| 搜尋 + 篩選同時啟用 | — | 兩者取交集 |
| 無匹配結果 | 搜尋或篩選 | 顯示「找不到符合條件的歌曲」並建議清除篩選條件 |
| 搜尋欄有內容 | 清除搜尋欄 | 恢復為完整歌曲列表（保留其他篩選條件） |

#### 3.1.3 嵌入播放（YouTube Playback）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 無播放中 | 點擊版本的播放按鈕 | 頁面底部出現播放器面板，YouTube 嵌入影片從該版本的開始時間戳播放 |
| 有播放中 | 點擊另一個版本的播放按鈕 | 播放器切換至新版本，從其時間戳開始播放 |
| 播放中 | 歌曲播放至結束時間戳 | 若播放佇列有下一首，自動播放；若無，播放器停止並顯示「播放完畢」 |
| 播放中 | 點擊暫停 | 暫停播放，按鈕切換為繼續 |
| 暫停中 | 點擊繼續 | 從暫停位置繼續播放 |
| 播放中 | 點擊下一首 | 跳至佇列中的下一首；若佇列為空，停止播放 |
| 播放中 | 點擊上一首 | 若已播放超過 3 秒，回到目前歌曲開始處；否則跳至佇列中的上一首 |

#### 3.1.4 播放佇列（Play Queue）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 任意 | 將版本加入佇列 | 版本加至佇列末端；顯示確認提示「已加入播放佇列」 |
| 佇列有項目 | 將相同版本再次加入 | 允許重複加入（佇列中出現兩次） |
| 佇列有項目 | 拖曳調整順序 | 佇列順序即時更新 |
| 佇列有項目 | 點擊移除 | 該項目從佇列中移除 |
| 佇列為空 | 開啟佇列面板 | 顯示「播放佇列為空」 |

#### 3.1.5 播放清單（Playlist）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 任意 | 建立新播放清單 | 輸入名稱後建立，名稱不可為空 |
| 播放清單存在 | 將版本加入播放清單 | 版本加至播放清單末端 |
| 播放清單存在 | 將已存在的版本再次加入 | 阻止操作，顯示「此版本已在播放清單中」 |
| 播放清單存在 | 拖曳調整版本順序 | 順序即時更新 |
| 播放清單存在 | 移除版本 | 版本從播放清單移除 |
| 播放清單存在 | 重新命名 | 名稱更新，不可為空 |
| 播放清單存在 | 刪除播放清單 | 顯示確認對話框，確認後刪除 |
| 播放清單存在 | 播放 | 將播放清單所有版本載入佇列並從第一首開始播放 |
| 播放清單中的版本被策展人從系統刪除 | 開啟播放清單 | 標記已刪除的版本為「此版本已無法播放」，不自動移除 |

#### 3.1.6 使用者帳號（User Account）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 未登入 | 使用系統 | 所有播放清單存於 localStorage，功能完整可用 |
| 未登入 | 點擊登入 | 導向登入頁面 |
| 未登入、localStorage 有資料 | 登入成功 | 提示合併選項：(a) 合併本機與雲端清單 (b) 以雲端覆蓋本機 (c) 以本機覆蓋雲端 |
| 未登入、localStorage 無資料 | 登入成功 | 載入雲端播放清單 |
| 已登入 | 修改播放清單 | 變更即時同步至雲端 |
| 已登入 | 登出 | 雲端資料保留，本機清除登入狀態；localStorage 保留最後一次同步的播放清單快照 |

#### 3.1.7 策展管理（Curator Management）

| 狀態 | 操作 | 結果 |
|------|------|------|
| 策展人已登入 | 新增直播場次 | 輸入 YouTube 影片 URL、直播日期、標題；系統驗證 URL 格式 |
| 直播場次存在 | 新增歌曲版本 | 輸入歌名、原唱者、開始時間戳、結束時間戳（選填）、標籤（選填）；若歌名已存在於目錄，自動關聯至該歌曲 |
| 歌名不存在於目錄 | 新增歌曲版本 | 自動建立新歌曲條目並關聯此版本 |
| 版本存在 | 編輯版本資料 | 可修改所有欄位，儲存後粉絲端即時更新 |
| 版本存在 | 刪除版本 | 顯示確認對話框並警告「此版本可能存在於粉絲的播放清單中」；確認後刪除 |
| 歌曲的最後一個版本被刪除 | — | 歌曲條目保留（版本數顯示為 0），不自動刪除歌曲 |
| 策展人已登入 | 編輯歌曲後設資料 | 可修改歌名、原唱者、標籤；變更套用至歌曲條目，版本資料不受影響 |

### 3.2 Error Scenarios

| 錯誤情境 | 系統行為 |
|----------|----------|
| YouTube 影片已被刪除或設為私人 | 播放器顯示「此影片已無法播放」；歌曲版本保留在目錄中但播放按鈕置灰 |
| YouTube IFrame API 載入失敗 | 顯示錯誤訊息「播放器載入失敗，請重新整理頁面」；歌曲目錄與播放清單功能不受影響 |
| 時間戳超出影片長度 | 播放器從影片開頭播放，並顯示提示「時間戳可能有誤」 |
| 策展人輸入的 YouTube URL 格式無效 | 表單驗證阻止提交，顯示「請輸入有效的 YouTube URL」 |
| 策展人輸入的時間戳格式無效 | 表單驗證阻止提交，顯示「請輸入有效的時間戳格式（如 1:23:45 或 01:23:45）」 |
| localStorage 已滿（約 5MB） | 在儲存播放清單時顯示「本機儲存空間不足，請登入帳號以使用雲端儲存」 |
| 帳號同步時網路中斷 | 變更保存至 localStorage 作為暫存，恢復連線後自動同步 |
| 帳號同步衝突（本機與雲端同時修改同一播放清單） | 採用最後修改時間戳勝出策略（last-write-wins），不靜默覆蓋——顯示通知告知使用者哪一端的變更被保留 |
| 策展管理介面未授權存取 | 導向登入頁面；非策展人帳號登入後顯示「您沒有管理權限」 |

### 3.3 System Boundary

| 類型 | MizukiPrism 控制 | MizukiPrism 依賴（外部） |
|------|------------------|--------------------------|
| 責任 | 歌曲與版本資料的儲存、搜尋、播放清單管理、使用者帳號管理 | 不負責影片託管、影片可用性、影片內容 |
| 互動 | 提供歌曲 CRUD API（策展人）、播放清單 API（粉絲）、前端 UI | 輸入：YouTube IFrame Player API（嵌入播放）；認證服務（帳號登入） |
| 控制 | 歌曲資料庫 schema、播放清單資料結構、搜尋邏輯、UI 呈現 | YouTube 影片可用性、YouTube API 速率限制、認證服務可用性 |

## 4. Refinement

### 4.1 Terminology

| 術語 | 英文 | 定義 |
|------|------|------|
| 歌曲 | Song | 一首曲目的抽象概念，由歌名與原唱者唯一識別。一首歌曲可對應多個版本。 |
| 版本 | Version | Mizuki 在特定直播場次中演唱某首歌曲的一次演出。版本屬於且僅屬於一首歌曲和一個直播場次。每個版本包含開始時間戳與選填的結束時間戳。 |
| 直播場次 | Stream | 一場完整的歌回直播，對應一個 YouTube 影片 URL。一個直播場次包含多個版本。 |
| 播放清單 | Playlist | 粉絲建立的版本有序集合，用於連續播放。一個播放清單不允許包含重複版本。 |
| 播放佇列 | Play Queue | 當前播放工作階段的暫時版本序列，允許重複。關閉頁面即消失。 |
| 標籤 | Tag | 附加在歌曲上的分類標記（如「動漫」、「J-POP」、「中文歌」），用於篩選。 |
| 粉絲 | Fan | 使用 MizukiPrism 瀏覽與播放歌曲的一般使用者。 |
| 策展人 | Curator | 擁有管理權限的使用者，負責維護歌曲、版本與直播場次資料。 |
| 時間戳 | Timestamp | 影片中的時間點，格式為 `H:MM:SS` 或 `HH:MM:SS`，標記版本在影片中的起訖位置。 |

### 4.2 Patterns

#### 4.2.1 歌曲-版本-直播場次關係

```
Song (1) ←──── (*) Version (*) ────→ (1) Stream
歌曲            版本                   直播場次
```

- 一首歌曲擁有一至多個版本
- 一個直播場次包含一至多個版本
- 版本是歌曲與直播場次的交會點
- 歌名 + 原唱者唯一識別一首歌曲
- YouTube URL 唯一識別一個直播場次

#### 4.2.2 播放清單與播放佇列的區別

| 特性 | 播放清單（Playlist） | 播放佇列（Play Queue） |
|------|----------------------|------------------------|
| 持久性 | 持久儲存（localStorage 或雲端） | 僅存在於當前瀏覽器工作階段 |
| 重複版本 | 不允許 | 允許 |
| 用途 | 長期收藏與整理 | 當次聆聽的即時排列 |
| 建立方式 | 使用者手動建立並命名 | 點擊播放或加入佇列時自動產生 |

#### 4.2.3 帳號與資料儲存模式

| 狀態 | 播放清單儲存位置 | 同步行為 |
|------|------------------|----------|
| 未登入 | localStorage | 無同步，僅限單一瀏覽器 |
| 已登入 | 雲端（主）+ localStorage（快取） | 變更即時同步至雲端；離線時暫存本機，上線後同步 |
| 登入時有本機資料 | 使用者選擇合併策略 | 三選一：合併 / 雲端覆蓋本機 / 本機覆蓋雲端 |

#### 4.2.4 策展人工作流程

```
登入管理介面
  └→ 新增直播場次（URL、日期、標題）
       └→ 逐首新增版本
            ├→ 歌名已存在 → 關聯至既有歌曲
            └→ 歌名不存在 → 自動建立新歌曲條目
                 └→ 版本即時出現在粉絲端
```

每次新增版本時，系統根據歌名 + 原唱者查找是否已有對應歌曲：
- 找到 → 新版本歸屬至該歌曲
- 未找到 → 建立新歌曲，版本歸屬至新歌曲
